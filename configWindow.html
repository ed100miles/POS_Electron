<!DOCTYPE html>
<html lang="en">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-uWxY/CJNBR+1zjPWmfnSnVxwRheevXITnMqoEIeG1LJrdI0GlVs/9cVSyPYXdcSF" crossorigin="anonymous">
<link rel='stylesheet' href="configWindow.css">

<head>
    <title>Mission Configuration</title>
</head>

<body>
    <h1>Mission Configuration</h1>
    <form id='config-form' class="form-check">
        <input class="form-check-input" type="checkbox" value="PTAG" id="PTAG">
        <label class="form-check-label" for="PTAG">Add part of speech tags to output</label>
        <br>
        <br>
        <input class="form-check-input" type="checkbox" value="AMBI_NOUN" id="AMBI_NOUN">
        <label class="form-check-label" for="AMBI_NOUN">Count ambiguous noun/verbs (end, dance, cut, dress, etc) as verbs</label>
        <br>
        <br>
        <input class="form-check-input" type="checkbox" value="NN" id="NN">
        <label class="form-check-label" for="NN">NN: noun, singular (cat, tree)</label>
        <br>

        <input class="form-check-input" type="checkbox" value="NNS" id="NNS">
        <label class="form-check-label" for="NNS">NNS: noun plural (desks)</label>
        <br>

        <input class="form-check-input" type="checkbox" value="NNP" id="NNP">
        <label class="form-check-label" for="NNP">NNP: proper noun, singular (Ed, Lewis)</label>
        <br>

        <input class="form-check-input" type="checkbox" value="NNPS" id="NNPS">
        <label class="form-check-label" for="NNPS">NNPS: proper noun, plural (indians or americans)</label>
        <br>
        <br>
        <input class="form-check-input" type="checkbox" value="VB" id="VB">
        <label class="form-check-label" for="VB">VB: verb (ask)</label>
        <br>
        <input class="form-check-input" type="checkbox" value="VBG" id="VBG">
        <label class="form-check-label" for="VBG">VBG: verb gerund (judging)VBD</label>
        <br>
        <input class="form-check-input" type="checkbox" value="VBD" id="VBD">
        <label class="form-check-label" for="VBD">VBD: verb past tense (pleaded)</label>
        <br>
        <input class="form-check-input" type="checkbox" value="VBN" id="VBN">
        <label class="form-check-label" for="VBN">VBN: verb past participle (reunified)</label>
        <br>
        <input class="form-check-input" type="checkbox" value="VBP" id="VBP">
        <label class="form-check-label" for="VBP">VBP: verb, present tense not 3rd person singular(wrap)</label>
        <br>
        <input class="form-check-input" type="checkbox" value="VBZ" id="VBZ">
        <label class="form-check-label" for="VBZ">VBZ: verb, present tense with 3rd person singular (bases)</label>
        <br>
    </form>
    <br>
    <form id='ignore-words-form' class="row g-3 align-items-center">
        <div class="col-auto">
            <label for="ignore-words-input" class="form-label">Ignore Word:</label>
        </div>
        <div class="col-auto">
            <input type="text" class="form-control" id='ignore-words-input'>
        </div>
        <label>Ignored Words:</label>
        <ul class='list-group' id='ignored-words-list'></ul>
    </form>
    </div>

    <div id='btn-div'>
        <button type="submit" form="config-form" class="btn btn-primary">Save Configuration</button>
    </div>

    <script>
        const electron = require('electron');
        const fs = require('fs')
        const { ipcRenderer } = electron;
        const configForm = document.getElementById('config-form')
        const ignoreWordsForm = document.getElementById('ignore-words-form')
        const ignoredWordsList = document.getElementById('ignored-words-list')

        let ignoreWords = []

        ignoreWordsForm.addEventListener('submit', addIgnoreWord)
        configForm.addEventListener('submit', saveConfig)

        ipcRenderer.on('update-config', updateConfig())

        function updateConfig() {
            let posConfig
            fs.readFile('pos_config.json', (err, data) => {
                if (err) throw err;
                posConfig = JSON.parse(data);
                console.log(posConfig);
                for (let noun of posConfig['nouns']) {
                    document.getElementById(noun).checked = true
                };
                for (let verb of posConfig['verbs']) {
                    document.getElementById(verb).checked = true
                };
                for (let word of posConfig['ignore_words']) {
                    let item = document.createElement('li');
                    item.classList.add('dblClickDelete', 'list-group-item')
                    item.addEventListener('dblclick', dblClickDelete)
                    let item_text = document.createTextNode(word)
                    item.appendChild(item_text)
                    ignoredWordsList.appendChild(item)
                    ignoreWords.push(word)
                }
                if (posConfig['save_pos_tags']) {
                    document.getElementById('PTAG').checked = true
                }
                if (posConfig['ambig_nouns']){
                    document.getElementById('AMBI_NOUN').checked = true
                }
            });
        };

        function addIgnoreWord(e) {
            e.preventDefault()
            let item = document.createElement('li');
            item.classList.add('dblClickDelete', 'list-group-item')
            item.addEventListener('dblclick', dblClickDelete)
            let ignoreWord = document.getElementById('ignore-words-input').value
            let item_text = document.createTextNode(ignoreWord)
            item.appendChild(item_text)
            ignoredWordsList.appendChild(item)
            document.getElementById('ignore-words-form').reset()
            ignoreWords.push(ignoreWord)
        }

        function dblClickDelete(e) {
            let index = ignoreWords.indexOf(e.target.innerHTML)
            ignoreWords.splice(index, 1)
            ignoredWordsList.removeChild(e.target)
            console.log(ignoreWords)
        }

        function saveConfig(e) {
            e.preventDefault()
            let configJSON = {}
            let nouns = []
            let verbs = []
            let savePosTags = false
            let ambiguous_nouns = false
            let ignore_words = ignoreWords
            let elements = document.getElementById('config-form').elements;

            for (let element of elements) {
                if (element.checked) {
                    if (element.value[0] == 'N') {
                        nouns.push(element.value)
                    }
                    if (element.value[0] == 'V') {
                        verbs.push(element.value)
                    }
                    if (element.value[0] == 'P') {
                        savePosTags = true
                    }
                    if (element.value == 'AMBI_NOUN'){
                        ambiguous_nouns = true
                    }
                }
            }

            configJSON["nouns"] = nouns
            configJSON["verbs"] = verbs
            configJSON['ambig_nouns'] = ambiguous_nouns
            configJSON["save_pos_tags"] = savePosTags
            configJSON["ignore_words"] = ignoreWords

            fs.writeFile('pos_config.json', JSON.stringify(configJSON), function (err) {
                if (err) return console.log('Configuration Update Error. Speak to Ed.')
            })
        }
    </script>

</body>

</html>